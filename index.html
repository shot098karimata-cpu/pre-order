<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>テイクアウト注文シート</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: 'Inter', 'Noto Sans JP', sans-serif; }
        .order-sheet { transition: all 0.3s ease-in-out; border-color: #e5e7eb; }
        .order-sheet:not(:first-child) { margin-top: 2rem; }
        .required-label::after { content: '*'; color: #ef4444; margin-left: 0.25rem; }
        .hidden { display: none; }
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.6); display: flex; justify-content: center; align-items: center; z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; }
        .modal-overlay.visible { opacity: 1; visibility: visible; }
        .modal-content { background-color: white; padding: 1.5rem; border-radius: 0.5rem; width: 90%; max-width: 500px; max-height: 80vh; overflow-y: auto; transform: scale(0.9); transition: transform 0.3s; }
        .modal-overlay.visible .modal-content { transform: scale(1); }
        /* ★★★ 確認モーダルのボタンテキストサイズを小さくする ★★★ */
        .modal-button {
            font-size: 0.875rem; /* text-sm */
            padding: 0.5rem 1rem; /* py-2 px-4 */
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-4xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">テイクアウト<br>注文シート</h1>
            <p class="text-gray-600 mt-2">ご注文内容をご入力ください。</p>
        </header>

        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
            <h2 class="text-2xl font-semibold mb-4 border-b pb-2">お客様情報</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="customerName" class="block text-sm font-medium text-gray-700 mb-1 required-label">お名前</label>
                    <input type="text" id="customerName" name="customerName" class="w-full p-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" required>
                </div>
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-1 required-label">受取日時</label>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <select id="pickupDate" name="pickupDate" class="w-full p-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" required></select>
                        </div>
                        <div>
                             <select id="pickupTime" name="pickupTime" class="w-full p-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" required></select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="order-sheets-container"></div>
        <div class="text-center mt-6">
            <p class="text-red-600 font-semibold">※お支払いは現金のみになります。</p>
        </div>
        <div class="flex flex-col sm:flex-row gap-4 mt-8">
            <button id="add-order-btn" class="w-full sm:w-auto flex-grow bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 transition duration-300 shadow-md">注文を追加</button>
            <button id="submit-order-btn" class="w-full sm:w-auto flex-grow bg-emerald-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-emerald-700 transition duration-300 shadow-md">注文内容を確認する</button>
        </div>
    </div>

    <template id="order-sheet-template">
        <div class="order-sheet bg-white p-6 rounded-lg shadow-md border-t-4 border-indigo-500">
            <div class="flex justify-between items-center border-b pb-3 mb-6">
                <h3 class="text-2xl font-bold text-gray-800 sheet-title">注文 1</h3>
                <button type="button" class="remove-order-btn text-red-500 hover:text-red-700 font-semibold py-1 px-3 rounded-md transition duration-300">この注文をキャンセル</button>
            </div>
            <form class="order-form space-y-8">
                <fieldset>
                    <legend class="text-lg font-semibold text-gray-900 mb-2 required-label">１．サイズ（ライスの量）</legend>
                    <div class="flex flex-wrap gap-4">
                        <label class="flex items-center p-3 border rounded-lg has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-500 cursor-pointer"><input type="radio" name="size" value="Sサイズ (140g)" class="mr-2" required>Sサイズ (140g)</label>
                        <label class="flex items-center p-3 border rounded-lg has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-500 cursor-pointer"><input type="radio" name="size" value="Mサイズ (180g)" class="mr-2">Mサイズ (180g)</label>
                        <label class="flex items-center p-3 border rounded-lg has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-500 cursor-pointer"><input type="radio" name="size" value="Lサイズ (220g)" class="mr-2">Lサイズ (220g)</label>
                    </div>
                </fieldset>
                <fieldset>
                    <legend class="text-lg font-semibold text-gray-900 mb-2 required-label">２．SET/単品</legend>
                    <div class="flex flex-wrap items-center gap-4">
                        <label class="flex items-center p-3 border rounded-lg has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-500 cursor-pointer"><input type="radio" name="type" value="SET" class="mr-2 order-type" required>SET</label>
                        <label class="flex items-center p-3 border rounded-lg has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-500 cursor-pointer"><input type="radio" name="type" value="単品" class="mr-2 order-type">単品</label>
                        <span class="text-sm text-red-600 set-description hidden">（SET内容トッピング＋ドリンク各１種）</span>
                    </div>
                </fieldset>
                <fieldset class="topping-fieldset">
                    <legend class="text-lg font-semibold text-gray-900 mb-2 topping-label">3. トッピング (複数選択可)</legend>
                    <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                        <label class="flex items-center p-3 border rounded-lg has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-500 cursor-pointer"><input type="checkbox" name="topping" value="アボカド" class="mr-2" data-price="150">アボカド</label>
                        <label class="flex items-center p-3 border rounded-lg has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-500 cursor-pointer"><input type="checkbox" name="topping" value="パクチー" class="mr-2" data-price="150">パクチー</label>
                        <label class="flex items-center p-3 border rounded-lg has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-500 cursor-pointer"><input type="checkbox" name="topping" value="目玉焼き" class="mr-2" data-price="150">目玉焼き</label>
                        <label class="flex items-center p-3 border rounded-lg has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-500 cursor-pointer"><input type="checkbox" name="topping" value="ジューシーベーコン" class="mr-2" data-price="150">ジューシーベーコン</label>
                        <label class="flex items-center p-3 border rounded-lg has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-500 cursor-pointer"><input type="checkbox" name="topping" value="スパム" class="mr-2" data-price="150">スパム</label>
                        <label class="flex items-center p-3 border rounded-lg has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-500 cursor-pointer"><input type="checkbox" name="topping" value="焼き野菜" class="mr-2" data-price="150">焼き野菜</label>
                        <label class="flex items-center p-3 border rounded-lg has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-500 cursor-pointer"><input type="checkbox" name="topping" value="マグマソース" class="mr-2" data-price="150">マグマソース</label>
                    </div>
                    <p class="text-red-600 text-sm mt-4">※「追いチーズ」と「追加ライス」は<br>容器の関係上出来ません。</p>
                </fieldset>
                <div class="drink-fieldset hidden">
                    <label class="text-lg font-semibold text-gray-900 mb-2 drink-label">4. ドリンク</label>
                    <select name="drink" class="w-full p-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="">-- 選択してください --</option>
                        <option value="コーラ">コーラ</option>
                        <option value="ジンジャーエール">ジンジャーエール</option>
                        <option value="カルピス">カルピス</option>
                        <option value="さんぴん茶">さんぴん茶</option>
                        <option value="ウーロン茶">ウーロン茶</option>
                        <option value="ホットウーロン茶">ホットウーロン茶</option>
                        <option value="アイスコーヒー">アイスコーヒー</option>
                        <option value="沖縄バヤリース">沖縄バヤリース</option>
                    </select>
                </div>
                <fieldset>
                    <legend class="text-lg font-semibold text-gray-900 mb-2 required-label">5. タコスミート</legend>
                    <div class="flex flex-wrap gap-4">
                        <label class="flex items-center p-3 border rounded-lg has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-500 cursor-pointer"><input type="radio" name="meat" value="ひき肉" class="mr-2" required>ひき肉</label>
                        <label class="flex items-center p-3 border rounded-lg has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-500 cursor-pointer"><input type="radio" name="meat" value="ハーフ＆ハーフ" class="mr-2">ハーフ＆ハーフ</label>
                        <label class="flex items-center p-3 border rounded-lg has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-500 cursor-pointer"><input type="radio" name="meat" value="カルニタス" class="mr-2">カルニタス</label>
                    </div>
                    <p class="text-red-600 text-sm mt-4">※「カルニタス」が完売になっている場合、「ひき肉」のみでのご提供となります。</p>
                </fieldset>
                <fieldset class="sauce-fieldset">
                    <legend class="text-lg font-semibold text-gray-900 mb-2 required-label">6. ソース選択（２種類まで）</legend>
                    <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                        <label class="flex items-center p-3 border rounded-lg has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-500 cursor-pointer"><input type="checkbox" name="sauce" value="ホットソース" class="mr-2">ホットソース</label>
                        <label class="flex items-center p-3 border rounded-lg has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-500 cursor-pointer"><input type="checkbox" name="sauce" value="ベーシックソース" class="mr-2">ベーシックソース</label>
                        <label class="flex items-center p-3 border rounded-lg has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-500 cursor-pointer"><input type="checkbox" name="sauce" value="バーベキューソース" class="mr-2">バーベキューソース</label>
                        <label class="flex items-center p-3 border rounded-lg has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-500 cursor-pointer"><input type="checkbox" name="sauce" value="ベジタブルソース" class="mr-2">ベジタブルソース</label>
                        <label class="flex items-center p-3 border rounded-lg has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-500 cursor-pointer"><input type="checkbox" name="sauce" value="チミチュリソース" class="mr-2">チミチュリソース</label>
                        <label class="flex items-center p-3 border rounded-lg has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-500 cursor-pointer"><input type="checkbox" name="sauce" value="サワークリームソース" class="mr-2">サワークリームソース</label>
                    </div>
                </fieldset>
                <div>
                    <label class="text-lg font-semibold text-gray-900 mb-2 block">7. 備考</label>
                    <textarea name="remarks" rows="3" class="w-full p-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" placeholder="例：チーズ抜き、豚アレルギーがあります。"></textarea>
                </div>
            </form>
        </div>
    </template>
    
    <div id="success-message" class="fixed top-5 right-5 bg-green-500 text-white py-3 px-5 rounded-lg shadow-xl transition-transform transform translate-x-[120%]">
        <p>ご注文ありがとうございました！</p>
    </div>

    <div id="confirmation-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 class="text-2xl font-bold text-center mb-4">最終確認画面</h2>
            <pre id="modal-summary" class="bg-gray-100 p-4 rounded-md text-sm whitespace-pre-wrap mb-6"></pre>
            <div class="flex justify-end gap-4">
                <button id="modal-cancel-btn" class="modal-button bg-gray-300 text-gray-800 font-bold rounded-lg hover:bg-gray-400 transition">修正する</button>
                <button id="modal-confirm-btn" class="modal-button bg-emerald-600 text-white font-bold rounded-lg hover:bg-emerald-700 transition">この内容で送信</button>
            </div>
        </div>
    </div>

<script>
    liff.init({
        liffId: "2008011772-m1MB7kB8"
    })
    .then(() => {
        if (!liff.isLoggedIn()) {
            liff.login();
        } else {
            main();
        }
    })
    .catch((err) => {
        console.error("LIFF Init Error:", err);
        alert('LIFFの初期化に失敗しました。ページを再読み込みしてください。');
    });

    function main() {
        const orderSheetsContainer = document.getElementById('order-sheets-container');
        const template = document.getElementById('order-sheet-template');
        let orderCount = 0;
        const FORM_STORAGE_KEY = 'takeoutOrderState';

        const saveFormState = () => { /* ... 省略 ... */ };
        const loadFormState = () => { /* ... 省略 ... */ };
        const populatePickupDates = () => { /* ... 省略 ... */ };
        const populatePickupTimes = (selectedDate) => { /* ... 省略 ... */ };
        
        const addOrderSheet = () => {
            orderCount++;
            const newSheet = template.content.cloneNode(true);
            const sheetDiv = newSheet.querySelector('.order-sheet');
            sheetDiv.dataset.orderId = orderCount;
            const formElements = newSheet.querySelectorAll('input, select, textarea');
            formElements.forEach(el => {
                const originalName = el.name;
                if (originalName) el.name = `${originalName}-${orderCount}`;
            });
            newSheet.querySelector('.sheet-title').textContent = `注文 ${orderCount}`;

            // ★★★ ソース選択の制限機能をここに追加 ★★★
            const sauceFieldset = newSheet.querySelector('.sauce-fieldset');
            sauceFieldset.addEventListener('change', (event) => {
                if (event.target.name.startsWith('sauce-')) {
                    const checkboxes = sauceFieldset.querySelectorAll('input[type="checkbox"]');
                    const checkedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
                    
                    checkboxes.forEach(cb => {
                        if (!cb.checked && checkedCount >= 2) {
                            cb.disabled = true;
                            cb.parentElement.classList.add('opacity-50', 'cursor-not-allowed');
                        } else {
                            cb.disabled = false;
                            cb.parentElement.classList.remove('opacity-50', 'cursor-not-allowed');
                        }
                    });
                }
            });

            orderSheetsContainer.appendChild(newSheet);
            updateOrderTypeRequirements(sheetDiv);
            updateSheetTitles();
        };

        const removeOrderSheet = (button) => { /* ... 省略 ... */ };
        const updateSheetTitles = () => { /* ... 省略 ... */ };
        const handleOrderTypeChange = (event) => { /* ... 省略 ... */ };
        const updateOrderTypeRequirements = (sheet) => { /* ... 省略 ... */ };
        const validateForms = () => { /* ... 省略 ... */ };
        const collectOrderData = () => { /* ... 省略 ... */ };
        const showSuccessMessage = () => { /* ... 省略 ... */ };

        const resetForm = () => {
            localStorage.removeItem(FORM_STORAGE_KEY);
            document.getElementById('customerName').value = '';
            orderSheetsContainer.innerHTML = '';
            orderCount = 0;
            initializeForm();
        };
        
        const handleSubmit = () => {
            if (!validateForms()) return;
            const { summary } = collectOrderData();
            
            const modal = document.getElementById('confirmation-modal');
            const summaryPre = document.getElementById('modal-summary');
            const confirmBtn = document.getElementById('modal-confirm-btn');
            const cancelBtn = document.getElementById('modal-cancel-btn');

            summaryPre.textContent = summary;
            modal.classList.add('visible');

            const confirmHandler = () => {
                modal.classList.remove('visible');
                liff.sendMessages([{ type: 'text', text: summary }])
                    .then(() => {
                        alert('お店に注文内容を送信しました！');
                        showSuccessMessage();
                        setTimeout(() => {
                            resetForm();
                            liff.closeWindow();
                        }, 500);
                    })
                    .catch((err) => {
                        alert('メッセージ送信に失敗しました。この機能は公式アカウントとのトーク画面からのみ利用できます。');
                        console.error('sendMessages Error:', err);
                    });
                
                confirmBtn.removeEventListener('click', confirmHandler);
                cancelBtn.removeEventListener('click', cancelHandler);
            };

            const cancelHandler = () => {
                modal.classList.remove('visible');
                confirmBtn.removeEventListener('click', confirmHandler);
                cancelBtn.removeEventListener('click', cancelHandler);
            };

            confirmBtn.addEventListener('click', confirmHandler);
            cancelBtn.addEventListener('click', cancelHandler);
        };

        const initializeForm = (profileName = '') => {
            if (profileName) document.getElementById('customerName').value = profileName;
            populatePickupDates();
            const dateSelect = document.getElementById('pickupDate');
            populatePickupTimes(dateSelect.value);
            addOrderSheet();
        };
        
        document.body.addEventListener('click', (event) => {
            if (event.target.id === 'add-order-btn') addOrderSheet();
            if (event.target.id === 'submit-order-btn') handleSubmit();
            if (event.target.classList.contains('remove-order-btn')) removeOrderSheet(event.target);
        });
        
        document.body.addEventListener('change', (event) => {
            if (event.target.classList.contains('order-type')) handleOrderTypeChange(event);
            if (event.target.id === 'pickupDate') populatePickupTimes(event.target.value);
            if(event.target.closest('.order-form') || event.target.closest('.bg-white')) {
                saveFormState();
            }
        });
        
        populatePickupDates();
        if (!loadFormState()) {
            liff.getProfile()
                .then(profile => initializeForm(profile.displayName))
                .catch(err => {
                    console.error("Profile Error:", err);
                    initializeForm();
                });
        }
    }

    // --- 変更がない関数群（見通しのため省略） ---
    function saveFormState(){const e={customerName:document.getElementById("customerName").value,pickupDate:document.getElementById("pickupDate").value,pickupTime:document.getElementById("pickupTime").value,orderSheetsHTML:document.getElementById("order-sheets-container").innerHTML,orderCount:window.orderCount};localStorage.setItem("takeoutOrderState",JSON.stringify(e))}function loadFormState(){const e=localStorage.getItem("takeoutOrderState");if(!e)return!1;const t=JSON.parse(e);if(t.pickupDate<(new Date).toISOString().split("T")[0])return localStorage.removeItem("takeoutOrderState"),!1;document.getElementById("customerName").value=t.customerName||"",document.getElementById("pickupDate").value=t.pickupDate,populatePickupTimes(t.pickupDate),document.getElementById("pickupTime").value=t.pickupTime;const o=document.getElementById("order-sheets-container");return o.innerHTML=t.orderSheetsHTML||"",window.orderCount=t.orderCount||0,""===o.innerHTML&&addOrderSheet(),!0}function populatePickupDates(){const e=document.getElementById("pickupDate");if(e){e.innerHTML="";const t=new Date,o=["日","月","火","水","木","金","土"];for(let d=0;d<7;d++){const a=new Date(t);a.setDate(t.getDate()+d);const n=a.getMonth()+1,i=a.getDate(),l=o[a.getDay()],c=document.createElement("option");c.value=`${a.getFullYear()}-${String(n).padStart(2,"0")}-${String(i).padStart(2,"0")}`,c.textContent=0===d?`今日 ${n}/${i}(${l})`:`${n}/${i}(${l})`,e.appendChild(c)}}}function populatePickupTimes(e){const t=document.getElementById("pickupTime");if(t){t.innerHTML="";const o=e=>(`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`),d=new Date,a=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`,n=e===a;let i;if(n){let l=new Date;l.setMinutes(l.getMinutes()+10);const c=l.getMinutes()%5;c!==0&&l.setMinutes(l.getMinutes()+(5-c));const r=new Date;r.setHours(11,30,0,0),i=l>r?l:r}else i=new Date(e+"T00:00:00"),i.setHours(11,30,0,0);const s=new Date(i);s.setHours(16,0,0,0);let m=!1;let u=new Date(i.getTime());for(;u<s;){const p=new Date(u.getTime()),g=new Date(u.getTime());if(g.setMinutes(g.getMinutes()+10),g>s)break;const f=o(p)+"～"+o(g),k=document.createElement("option");k.value=f,k.textContent=f,t.appendChild(k),m=!0,u.setMinutes(u.getMinutes()+5)}if(!m){const y=document.createElement("option");y.value="",y.textContent=n?"本日の受付は終了しました":"受付時間外です",y.disabled=!0,t.appendChild(y)}}}function removeOrderSheet(e){confirm("この注文をキャンセルしますか？")&&(e=e.closest(".order-sheet"),e.style.transform="scale(0.9)",e.style.opacity="0",setTimeout(()=>{e.remove(),updateSheetTitles(),saveFormState()},300))}function updateSheetTitles(){const e=document.querySelectorAll(".order-sheet");e.forEach((e,t)=>{e.querySelector(".sheet-title").textContent=`注文 ${t+1}`})}function handleOrderTypeChange(e){const t=e.target.closest(".order-sheet");updateOrderTypeRequirements(t)}function updateOrderTypeRequirements(e){const t=e.dataset.orderId,o=e.querySelector(`input[name="type-${t}"]:checked`),d=o&&"SET"===o.value,a=e.querySelector(".topping-label"),n=e.querySelector(".drink-fieldset"),i=e.querySelector(".drink-label"),l=e.querySelector(`select[name="drink-${t}"]`),c=e.querySelector(".set-description");d?(a.classList.add("required-label"),n.classList.remove("hidden"),i.classList.add("required-label"),l.disabled=!1,l.required=!0,c.classList.remove("hidden")):(a.classList.remove("required-label"),n.classList.add("hidden"),i.classList.remove("required-label"),l.disabled=!0,l.required=!1,l.value="",c.classList.add("hidden"))}function validateForms(){const e=document.getElementById("customerName").value.trim(),t=document.getElementById("pickupDate").value,o=document.getElementById("pickupTime").value;if(!e||!t||!o)return alert("お客様情報の必須項目（お名前、受取日時）をすべて入力してください。"),!1;const d=document.querySelectorAll(".order-sheet");if(0===d.length)return alert("少なくとも1つの注文を追加してください。"),!1;for(const a of d){const n=a.querySelector(".order-form"),i=a.querySelector(".sheet-title").textContent,l=a.dataset.orderId;if(!n.checkValidity())return alert(`${i}に未入力の項目があります。`),n.reportValidity(),!1;const c=a.querySelector(`input[name="type-${l}"]:checked`);if(c&&"SET"===c.value){if(0===a.querySelectorAll(`input[name="topping-${l}"]:checked`).length)return alert(`${i}でセットを選択した場合、トッピングを1つ以上選択してください。`),!1;if(!a.querySelector(`select[name="drink-${l}"]`).value)return alert(`${i}でセットを選択した場合、ドリンクを選択してください。`),!1}const r=a.querySelectorAll(`input[name="sauce-${l}"]:checked`).length;if(0===r||r>2)return alert(`${i}でソースを1つ以上、2つまで選択してください。`),!1}return!0}function collectOrderData(){const e={ "Sサイズ (140g)":{単品:1e3,SET:1320},"Mサイズ (180g)":{単品:1100,SET:1430},"Lサイズ (220g)":{単品:1200,SET:1540}},t=350,o=document.getElementById("customerName").value.trim(),d=document.getElementById("pickupDate"),a=d.options[d.selectedIndex].textContent,n=document.getElementById("pickupTime").value;let i=`【お客様情報】\nお名前: ${o}様\n受取日時: ${a} ${n}\n------------------------------\n\n`;let l=0;return document.querySelectorAll(".order-sheet").forEach((o,d)=>{let a=0;const c=o.dataset.orderId,r=o.querySelector(".order-form"),s=new FormData(r);i+=`【注文 ${d+1}】\n`;const m=o.querySelector(`input[name="size-${c}"]:checked`),u=o.querySelector(`input[name="type-${c}"]:checked`);m&&u?(a+=e[m.value][u.value]||0,i+=`サイズ: ${m.value}\n種類: ${u.value}\n`):m||(i+="サイズ: 未選択\n"),u||(i+="種類: 未選択\n");const p=o.querySelectorAll(`input[name="topping-${c}"]:checked`),g=u&&"SET"===u.value;if(p.length>0){const f=[];p.forEach((e,t)=>{f.push(e.value),g&&0===t||(a+=parseFloat(e.dataset.price||0))}),i+=`トッピング: ${f.join(", ")}\n`}const k=s.get(`drink-${c}`);g&&k?i+=`ドリンク: ${k}\n`:k&&(i+=`追加ドリンク: ${k}\n`,a+=t);const y=o.querySelector(`input[name="meat-${c}"]:checked`);i+=y?`タコスミート: ${y.value}\n`:"タコスミート: 未選択\n";const h=s.getAll(`sauce-${c}`);h.length>0&&(i+=`ソース: ${h.join(", ")}\n`);const v=s.get(`remarks-${c}`);v&&""!==v.trim()&&(i+=`備考: ${v.trim()}\n`),i+=`\n--- この注文の合計: ${a}円 ---\n\n`,l+=a}),i+=`------------------------------\n総合計: ${l}円\n※お支払いは現金のみになります。\n※テイクアウトの対応は、店舗右側窓口にて対応いたします。。\n`,{summary:i,grandTotal:l,customerName:o}}function showSuccessMessage(){const e=document.getElementById("success-message");e.classList.remove("translate-x-[120%]"),setTimeout(()=>{e.classList.add("translate-x-[120%]")},4e3)}
</script>
</body>
</html>
